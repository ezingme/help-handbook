# 中小企业云门户流程审批配置手册
在系统设置-->流程类型里，我们提供了日常报销、借款申请、请假申请等16个常用流程类型模板，如果有其他流程类型的需要，可以点击右下角的“+”新建。
![](./images/1564729550481.png)
![](./images/1564729589089.png)
==**注：新建流程类型需新建对应的表单，如有需要，请联系我们。** #F44336==
在高级设置里，我们可以设置差旅报销关联差旅申请，只有有差旅申请的情况下，才能进行差旅报销的流程申请。
![](./images/1564730190795.png)
## 1 新建流程
管理员在系统设置-->流程定义中的流程一览可以查看设置流程，新建立的组织机构是没有流程的，需要我们点击右下角“+”新建。
![](./images/1564729264944.png)
选择需要设计的流程类型，完成后点击设计流程，这里我们选择了日常报销流程。
![](./images/1564730473422.png)
![](./images/1564730550228.png)
在弹出的界面填写流程名称。
==**注：该名称保存后不可修改。** #F44336==
![](./images/1564730631199.png)
点击确定后，我们进入到流程设计页面，系统会给我们提供最初始的流程模板，如果组织结构的流程审批只有一级（即提出申请，审批通过），可以直接使用该模板，这里我们直接用一级审批举例。
==**注：如果是多级审批，多部门分支等，见本文章3.1 多级、多部门流程结构。** #F44336==
![](./images/1564731200416.png)
在设计流程之前，我们需要有对应流程的表单，点击右边的表单按钮，设计表单。
在表单一览里，提供了16类常用流程类型对应的申请、待办表单，但是不能直接使用，需要我们复制。
==**注：点击新建表单可以自定义表单，关于自定义表单，如有需要，请联系我们。** #F44336==
![](./images/1564731878038.png)
找到日常报销对应的表单，点击后边的复制，输入表单名称，确定即可。
![](./images/1564732218250.png)
![](./images/1564732312467.png)
复制好表单后关闭表单一览界面，回到流程设计界面，双击之前图片中标记为A的启动流程圆圈。在弹出的页面中，点击表单，选择“日常报销-申请”，点击确定即可。
==**注：关于标记A、B、C等详细功能，见本文章2.2 组件。** #F44336==
![](./images/1564732944360.png)
双击之前图片中标记为C的UserTask（用户任务），选中审批人一览，在名称里输入该环节审批人的名字（可以不填写），在可以进行审批的用户里选择审批人。
![](./images/1564984859064.png)
在表单一栏里选择“日常报销-待办已办”表单，确定即可。
![](./images/1564734518836.png)
现在我们已经完成了简单日常报销流程的设定，点击右边的保存按钮（在设计过程中经常保存可以避免因其他原因导致设计的内容丢失），点击发布按钮，即可去流程一览里申请日常报销流程了。
![](./images/1564734602970.png)
![](./images/1564734905372.png)
在流程一览里就可以看见我们设置日常报销流程了。
![](./images/1564735002327.png)
点击开启手势码可以设置审批手势密码，在审批时需要绘制对应的手势密码。
![](./images/1564735084081.png)
设置宽屏显示，会让表单宽屏展示。
![](./images/1564735240505.png)
![](./images/1564735343833.png)
点击定义可以查看修改流程，停用按钮可以停止当前流程的使用。
复制按钮可以复制其他流程的结构、表单。
![](./images/1564735452509.png)
## 2 流程结构
在这里，我们会根据下图中标记的组件、按钮来详细的了解其功能。
![](./images/1564736269412.png)
### 2.1 功能型按钮
i 选择按钮：点击选择编辑区域的组件及工具栏内的按钮。
j 框选按钮：可以框选编辑区域的组件。
k 区域组件移动按钮：可以同时移动部分区域的组件。
n 表单按钮：进入表单一览按钮。
m 保存按钮：点击保存当前编辑，但不影响已经发布的流程。
l 发布按钮：发布当前编辑流程，若已经发布过，则更新已经发布的流程。
### 2.2 组件
#### 2.2.1 A(a) StartEvent：启动流程节点
启动流程节点每个流程只有一个，新建流程会自动生成一个，双击进入编辑状态。
在表单里可以选择该流程的申请表单。
![](./images/1564987923211.png)
在人员一栏里勾选发送邮件，选择人员后，该流程发起时，会向选择的人员邮箱发送抄送通知，同时该人员也可以在流程一览的抄送里查看流程进度。
![](./images/1564988086388.png)
![](./images/1564988310823.png)
#### 2.2.2 B(b) SequenceFlow：流程走向
流程走向代表着流程开始之后的走向，点击工具栏的b按钮可以在2个组件之间画出流程走向，双击进入编辑状态。流程走向可以设置一些选项来设置不同的走向，一般从A、C组件出来的流程走向不会设置筛选项，从D组件出来的流程走向会设置筛选项。
在人员一栏里，我们可以选择一个或多个人员，只有是选择的人员提出流程才会走这条支线，若勾选了排除，则除了被选择的人员，其他人都可以走这条支线。
![](./images/1564989114491.png)
在组织一栏里，我们可以选择一个或多个部门，只有是这个部门的人员发起流程才会走这条支线。
==**注：人员一栏和组织一栏可以同时设置，取交集。可以在名称里输入一些关于该分支的注释。** #F44336==
![](./images/1564989349120.png)
在用户操作一栏里，可以设置同意、不同意选项，这个只有在D组件和E组件之前的流程走向才能设置该选项，他会根据在流程进行时，D组件之前的C组件中的用户操作（即审批同意、不同意）来区分分支。
![](./images/1564989576007.png)
![](./images/1564989834384.png)
在自定义一栏中，我们可以设置一些条件表达式来设置分支，关于表达式的内容见本文章**2.4.2 流程走向节点表达式**。
![](./images/1564989900043.png)
#### 2.2.3 C(c) UserTask：用户任务
用户任务节点是流程进行审批的节点，在流程进行到这一节点时，需要审批人员去进行审批的。点击工具栏的c按钮可以在编辑区域新建一个用户任务，双击进入编辑状态，可以在名称里设置上审批人、审批组等信息。
在审批人一栏里，我们可以设置可以进行审批的人员、组，流程到该节点时由选择的人、组进行审批。若勾选了发送邮件，则会给审批人发送审批通知邮件。关于可进行审批的用户表达式见本文章**2.4.1 流程发起人**。
==**注：该情况下若选择多人审批，则此节点有一人审批之后流程就会继续往下走。** #F44336==
![](./images/1564990876948.png)
当审批人是多人会签时，我们就不能用上边设置的审批了，这里我们需要对用户任务进行一些设置，单击用户任务，在弹出的目录中点击“扳手”样式的改变类型按钮，然后点击下边“三竖”样式的会签按钮。
==**注：在流程设计时，如果想删除绘制错误的组件，单击该组件，点击删除按钮即可。** #F44336==
![](./images/1564992685569.png)
![](./images/1564992743929.png)
点击后会变成上图中的样式，双击用户任务，在会签里可选择多个人员或者审批组，在结束条件设置好该节点结束条件。
![](./images/1564993023311.png)
在表单里可以选择该流程的待办表单。
![](./images/1564991390076.png)
在期限一栏里，可以设置期望完成的期限。
![](./images/1564992063501.png)
#### 2.2.4 D(d) ExclusiveGateway：分支节点
分支节点是在流程出现分支时设置的，该节点无任何设置属性，点击工具栏处d按钮，放置在编辑区域即可。
#### 2.2.5 E(e) EndEvent：结束节点
结束节点是流程的结束位置，该节点名称必须为“同意”或者“不同意”。
在人员里若选择用户并勾选发送邮件，则在流程结束时会向选中的人员发送流程结果抄送邮件。
![](./images/1564993602406.png)
### 2.3 请假销假流程组件
请假销假流程组件是专门为请假申请2流程定制的组件，关于请假申请2的流程配置见本文章**3.2 请假申请、请假申请2**。
#### 2.3.1 h 流程属性按钮
流程属性按钮是请假申请2流程取消时设置调用接口的地方，该组件内容固定为：https://apis.icloudportal.com/v1/leaveCancelCallback
![](./images/1564996376205.png)
#### 2.3.2 g 请假回调节点
请假回调节点是请假申请2在流程进行时关联节假日、假期类别的节点，共存在3种情况。
2.3.2.1 请假
节点执行接口：https://apis.icloudportal.com/v1/applyLeaveSubmitCallback
API标记：applyLeave
![](./images/1564996596906.png)
2.3.2.2 请假不同意
节点执行接口：https://apis.icloudportal.com/v1/leaveCancelCallback
![](./images/1564996895085.png)
2.3.2.3 销假
节点执行接口：https://apis.icloudportal.com/v1/eliminateLeaveSubmitCallback
API标记：applyLeave,eliminateLeave
![](./images/1564996945183.png)
### 2.4 常见的流程表达式
### 2.4.1 流程发起人
${startedBy}是我们对于流程发起者设置的一个表达式，在流程审批过程中，部分环节可能不是审批不同意而是驳回到发起者，例如下图中的流程，在审批人审批不同意后会返回流程发起者修改，重新提交给流程审批人员。
![](./images/1565071412639.png)
我们只需在流程发起人（c组件）中设置审批人表达式即可。
![](./images/1565071572510.png)
### 2.4.2 流程走向节点表达式
在这里我们将会了解到一些流程中常用的表达式。
#### 2.4.2.1 印章申请
在印章申请流程中，我们设计了可以根据选择印章的不同，而走向不同分支的表达式。我们在模板中为印章申请提供了2套表单模板，不同模板的表达式不一样，请结合各公司的情况选择模板。
![](./images/1565072787300.png)
2.4.2.1.1 印章单选的表单：
![](./images/1565072836048.png)
如下图流程结构，在流程提交后，我们会根据表单里是否选择了“合同章”来判断流程走向。
![](./images/1565074195498.png)
在分支节点后的2条分支流向的自定义里分别填写上对应的表达式。
![](./images/1565074115500.png)
${ JSON(submission).prop("type").stringValue() ==  "合同章"}
${ JSON(submission).prop("type").stringValue() !=  "合同章"}
合同章可以替换成其他印章
2.4.2.1.2 印章多选的表单：
![](./images/1565072949863.png)
在多选表单里我们可以根据选择的印章里是否包含“合同章”来确定分支走向，方法同 **2.4.2.1.1** ，但是表达式换下即可。
${ JSON(submission).prop("type").hasProp('合同章') ==  true  }
${ JSON(submission).prop("type").hasProp('合同章') ==  false  }
#### 2.4.2.2 请假申请
在请假申请流程中，我们设计了可以根据请假天数的不同，而走向不同分支的表达式。如下图流程结构：
![](./images/1565075139932.png)
在分支节点后的2条分支流向的自定义里分别填写上对应的表达式。
![](./images/1565075182416.png)
${ JSON(submission).prop("daysofqingjia").numberValue() > 3}
${ JSON(submission).prop("daysofqingjia").numberValue() <= 3}
## 3 特殊流程、表单组件
### 3.1 多级、多部门流程结构
在了解了各个组件的功能之后，我们就可以设置多部门、多级别的流程结构了，如下图：
![](./images/1565076562260.png)
从启动流程节点开始后，经过分直节点会根据流程申请人所在的不同的部门走向不同的分支。
![](./images/1565076730892.png)
在第二个分支节点后边，会排除该部门部长（组长、经理等），直接到BOSS审批，其他人有该部长审批。
![](./images/1565076865879.png)
![](./images/1565076937276.png)
更多的部门、审批级别按照这个继续添加即可。
==**注：当申请人不属于各个部门或流程里没有申请人的部门时，流程提交会报错。** #F44336==
### 3.2 请假申请、请假申请2
在云门户中，我们为请假流程设置了2种形式，一种是普通的请假申请，请假申请的设置与其他流程一致，表单为下图：
![](./images/1565081882068.png)
一种是关联了节假日、假期信息的请假申请2，在请假申请2流程发起时，会自动获取管理员设置的节假日、假期信息，当员工选择的日期包含节假日、周末时，节假日不会计入请假天数里，在请假申请2流程发起后，申请人的个人信息中休假余额会减掉对应的请假天数。
在这里我们详细的了解下请假申请2的流程结构，基本结构如下图：
![](./images/1565082259206.png)
其中请假、请假不同意、销假、流程属性按照**2.3.2 g 请假回调节点**设置即可，销假时不同意则返回销假申请，使用的表单为下图：
![](./images/1565082396963.png)
多部门、多级别审批参照**3.1 多级、多部门流程结构**设置即可。
### 3.3 特殊表单组件
在这里我们会介绍一些定制的组件、功能等，如果您有需要，请联系我们。
#### 3.3.1 摘要
通过在表单中添加摘要组件，在流程一览中，我们可以看到对应的流程会有摘要信息。
![](./images/1565084407171.png)
#### 3.3.2 选择框-特殊组件
该组件可以关联到该组织的成员、部门、项目管理中的项目，设置时选择其中之一，表单的下拉内容就会关联对应的选项。
![](./images/1565084639721.png)
#### 3.3.3 2级、多级下拉菜单
该组件是多个下拉菜单的关联设置，类似于省、市、区这种根据前一个菜单的选项确定后一个菜单的可选择内容。
![](./images/1565158170751.png)
#### 3.3.4 自动编号组件
自动编号组件会根据系统设置中流水号设置里设置的编号类型，自动生成对应类型的编号，无需人工输入流水号。
![](./images/1565158534431.png)